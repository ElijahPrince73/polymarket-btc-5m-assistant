<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket BTC 5m Assistant</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>Polymarket BTC 5m Assistant</h1>
                <div class="sub">Paper trading dashboard • Live-ready plumbing</div>
            </div>
            <div class="pill" id="ui-port-pill">UI</div>
        </div>

        <div class="section section--dashboard">
            <div class="kpi-grid">
                <div class="kpi">
                    <div class="kpi-label">Balance</div>
                    <div class="kpi-value" id="kpi-balance">—</div>
                    <div class="kpi-sub" id="kpi-realized">Realized: —</div>
                </div>
                <div class="kpi">
                    <div class="kpi-label">PnL (Today)</div>
                    <div class="kpi-value" id="kpi-pnl-today">—</div>
                    <div class="kpi-sub" id="kpi-trades-today">Trades: —</div>
                </div>
                <div class="kpi">
                    <div class="kpi-label">PnL (Yesterday)</div>
                    <div class="kpi-value" id="kpi-pnl-yesterday">—</div>
                    <div class="kpi-sub" id="kpi-trades-yesterday">Trades: —</div>
                </div>
                <div class="kpi">
                    <div class="kpi-label">Win Rate</div>
                    <div class="kpi-value" id="kpi-winrate">—</div>
                    <div class="kpi-sub" id="kpi-profit-factor">PF: —</div>
                </div>
            </div>

            <div class="chart-grid">
                <div class="card">
                    <div class="card-title">Equity Curve</div>
                    <canvas id="chart-equity" height="120"></canvas>
                </div>
                <div class="card">
                    <div class="card-title">PnL by Exit Reason</div>
                    <canvas id="chart-exit" height="120"></canvas>
                </div>
                <div class="card">
                    <div class="card-title">Entry Price Bucket</div>
                    <canvas id="chart-entry-price" height="120"></canvas>
                </div>
                <div class="card">
                    <div class="card-title">PnL Distribution (Last 200)</div>
                    <canvas id="chart-pnl-hist" height="120"></canvas>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Status</h2>
            <div id="status-message">Loading...</div>
        </div>

        <div class="section">
            <h2>Open Trade</h2>
            <div id="open-trade">No open trade.</div>
        </div>

        <div class="section">
            <h2>Ledger Summary</h2>
            <div id="ledger-summary">Loading summary...</div>
        </div>

        <div class="section">
            <h2>Analytics</h2>
            <div id="analytics">
                <div id="analytics-overview">Loading analytics...</div>
                <div class="analytics-grid">
                    <div>
                        <h3>By Exit Reason</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-exit"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Entry Phase</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-phase"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Entry Price Bucket</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-price"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Side Inferred</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-inferred"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Entry Time Left</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-timeleft"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Entry Prob</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-prob"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Liquidity</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-liq"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Market Volume</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-mktvol"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Spread</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-spread"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Edge</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-edge"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By VWAP Dist</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-vwapdist"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By RSI</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-rsi"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Hold Time</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-hold"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By MAE (min uPnL)</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-mae"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By MFE (max uPnL)</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-mfe"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Side</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-side"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                    <div>
                        <h3>By Rec Action</h3>
                        <table class="mini-table"><thead><tr><th>Key</th><th>N</th><th>PnL ($)</th></tr></thead><tbody id="analytics-by-rec"><tr><td colspan="3">Loading...</td></tr></tbody></table>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="row-between">
                <h2>Trades</h2>
                <div class="filters">
                    <label>
                        Show
                        <select id="trades-limit">
                            <option value="25">25</option>
                            <option value="50" selected>50</option>
                            <option value="100">100</option>
                            <option value="200">200</option>
                        </select>
                    </label>
                    <label>
                        Reason
                        <select id="trades-reason">
                            <option value="">All</option>
                        </select>
                    </label>
                    <label>
                        Side
                        <select id="trades-side">
                            <option value="">All</option>
                            <option value="UP">UP</option>
                            <option value="DOWN">DOWN</option>
                        </select>
                    </label>
                    <label>
                        <input type="checkbox" id="trades-only-losses" /> losses only
                    </label>
                </div>
            </div>

            <table id="recent-trades-table">
                <thead>
                    <tr>
                        <th>Entry Time</th>
                        <th>Exit Time</th>
                        <th>Side</th>
                        <th>Entry (¢)</th>
                        <th>Exit (¢)</th>
                        <th>PnL ($)</th>
                        <th>Status</th>
                        <th>Reason</th>
                    </tr>
                </thead>
                <tbody id="recent-trades-body">
                    <tr><td colspan="8">Loading recent trades...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>