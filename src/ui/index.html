<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Polymarket BTC 5m Assistant</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div>
          <h1>Polymarket BTC 5m Assistant</h1>
          <div class="sub">Unified trading engine • Paper &amp; Live</div>
        </div>
        <div class="trading-controls">
          <select id="mode-select" class="mode-select">
            <option value="paper">Paper</option>
            <option value="live">Live</option>
          </select>
          <span id="trading-status" class="trading-status status--stopped">STOPPED</span>
          <button id="start-trading" class="action-button action-button--start">Start Trading</button>
          <button id="stop-trading" class="action-button action-button--stop" disabled>Stop Trading</button>
        </div>
      </div>

      <div class="section section--dashboard">
        <div class="kpi-grid">
          <div class="kpi">
            <div class="kpi-label">Balance</div>
            <div class="kpi-value" id="kpi-balance">—</div>
            <div class="kpi-sub" id="kpi-realized">Realized: —</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">PnL (Today)</div>
            <div class="kpi-value" id="kpi-pnl-today">—</div>
            <div class="kpi-sub" id="kpi-trades-today">Trades: —</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">PnL (Yesterday)</div>
            <div class="kpi-value" id="kpi-pnl-yesterday">—</div>
            <div class="kpi-sub" id="kpi-trades-yesterday">Trades: —</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">Win Rate</div>
            <div class="kpi-value" id="kpi-winrate">—</div>
            <div class="kpi-sub" id="kpi-profit-factor">PF: —</div>
          </div>
        </div>

        <div class="chart-grid">
          <div class="card">
            <div class="card-title">Equity Curve</div>
            <canvas id="chart-equity" height="120"></canvas>
          </div>
          <div class="card">
            <div class="card-title">PnL by Exit Reason</div>
            <canvas id="chart-exit" height="120"></canvas>
          </div>
          <div class="card">
            <div class="card-title">Entry Price Bucket</div>
            <canvas id="chart-entry-price" height="120"></canvas>
          </div>
          <div class="card">
            <div class="card-title">PnL Distribution (Last 200)</div>
            <canvas id="chart-pnl-hist" height="120"></canvas>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Analytics</h2>
        <div id="analytics-overview">No analytics data yet.</div>
        <div class="analytics-grid">
          <div class="card">
            <div class="card-title">By Exit Reason</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-exit"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Entry Phase</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-phase"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Entry Price</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-price"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Side Source</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-inferred"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Time Left at Entry</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-timeleft"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Model Probability</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-prob"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Liquidity</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-liq"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Market Volume</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-mktvol"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Spread</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-spread"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Edge</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-edge"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By VWAP Distance</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-vwapdist"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By RSI</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-rsi"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Hold Time</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-hold"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By MAE (Max Adverse)</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-mae"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By MFE (Max Favorable)</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-mfe"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Side (UP/DOWN)</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-side"></tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-title">By Rec Action</div>
            <table class="mini-table">
              <thead><tr><th>Bucket</th><th>Count</th><th class="num">PnL</th></tr></thead>
              <tbody id="analytics-by-rec"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Status</h2>
        <div id="status-message">Loading...</div>
      </div>

      <div class="section">
        <h2>Open Trade</h2>
        <div id="open-trade">No open trade.</div>
      </div>

      <div class="section">
        <h2>Ledger Summary</h2>
        <div id="ledger-summary">Loading summary...</div>
      </div>

      <div class="section">
        <div class="row-between">
          <h2>Trades</h2>
          <div class="filters">
            <label>
              Show
              <select id="trades-limit">
                <option value="25">25</option>
                <option value="50" selected>50</option>
                <option value="100">100</option>
                <option value="200">200</option>
              </select>
            </label>
            <label>
              Reason
              <select id="trades-reason">
                <option value="">All</option>
              </select>
            </label>
            <label>
              Side
              <select id="trades-side">
                <option value="">All</option>
                <option value="UP">UP</option>
                <option value="DOWN">DOWN</option>
              </select>
            </label>
            <label>
              <input type="checkbox" id="trades-only-losses" /> losses only
            </label>
          </div>
        </div>

        <table id="recent-trades-table">
          <thead>
            <tr>
              <th>Entry Time</th>
              <th>Exit Time</th>
              <th>Side</th>
              <th>Entry Price</th>
              <th>Exit Price</th>
              <th>PnL</th>
              <th>Status</th>
              <th>Exit Reason</th>
            </tr>
          </thead>
          <tbody id="recent-trades-body">
            <tr>
              <td colspan="8">Loading recent trades...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
